<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Returns the result of track expressions evaluation for each of the iterator
points."><title>Returns evaluated track expression — emr_extract • naryn</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Returns evaluated track expression — emr_extract"><meta property="og:description" content="Returns the result of track expressions evaluation for each of the iterator
points."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">naryn</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.6.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/naryn.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tanaylab/naryn/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Returns evaluated track expression</h1>
      <small class="dont-index">Source: <a href="https://github.com/tanaylab/naryn/blob/HEAD/R/extract.R" class="external-link"><code>R/extract.R</code></a></small>
      <div class="d-none name"><code>emr_extract.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Returns the result of track expressions evaluation for each of the iterator
points.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">emr_extract</span><span class="op">(</span>
  <span class="va">expr</span>,
  tidy <span class="op">=</span> <span class="cn">F</span>,
  sort <span class="op">=</span> <span class="cn">F</span>,
  names <span class="op">=</span> <span class="cn">NULL</span>,
  stime <span class="op">=</span> <span class="cn">NULL</span>,
  etime <span class="op">=</span> <span class="cn">NULL</span>,
  iterator <span class="op">=</span> <span class="cn">NULL</span>,
  keepref <span class="op">=</span> <span class="cn">F</span>,
  filter <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>expr</dt>
<dd><p>vector of track expressions</p></dd>
<dt>tidy</dt>
<dd><p>if 'TRUE' result is returned in "tidy"" format</p></dd>
<dt>sort</dt>
<dd><p>if 'TRUE' result is sorted by id, time and reference</p></dd>
<dt>names</dt>
<dd><p>names for the track expressions in the returned value. If
'NULL' names are set to the track expression themselves.</p></dd>
<dt>stime</dt>
<dd><p>start time scope</p></dd>
<dt>etime</dt>
<dd><p>end time scope</p></dd>
<dt>iterator</dt>
<dd><p>track expression iterator. If 'NULL' iterator is determined
implicitly based on track expressions. See also 'iterator' section.</p></dd>
<dt>keepref</dt>
<dd><p>If 'TRUE' references are preserved in the iterator.</p></dd>
<dt>filter</dt>
<dd><p>Iterator filter.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A set of ID-Time points with additional columns depending on the
value of 'tidy' (see above).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function returns the result of track expressions evaluation for each of
the iterator stops.</p>
<p>If 'tidy' is 'TRUE' the returned value is a set of ID-Time points with two
additional columns named 'expr' and 'value'. 'expr' marks the track
expression that produced the value. Rows with NaN values are omitted from
the tidy format.</p>
<p>If 'tidy' is 'FALSE' the returned value is a set of ID-Time points with an
additional column for the values of each of the track expressions.</p>
<p>If 'sort' is 'TRUE' the returned value is sorted by id, time and reference,
otherwise the order is not guaranteed especially for longer runs, when
multitasking might be launched. Sorting requires additional time, so it is
switched off by default.</p>
<p>'names' parameter sets the labels for the track expressions in the return
value. If 'names' is 'NULL' the labels are set to the track expression
themselves.</p>
    </div>
    <div class="section level2">
    <h2 id="iterator">iterator<a class="anchor" aria-label="anchor" href="#iterator"></a></h2>
    


<p>There are a few types of iterators:</p><ul><li><p>Track iterator: Track iterator returns the points (including the reference) from the specified track. Track name is specified as a string. If `keepref=FALSE` the reference of each point is set to `-1` <br>
Example: <br><br>
# Returns the level of glucose one hour after the insulin shot was made <br>
emr_vtrack.create("glucose", "glucose_track", func="avg", time.shift=1) <br>
emr_extract("glucose", iterator="insulin_shot_track") <br></p></li>
<li><p>Id-Time Points Iterator: Id-Time points iterator generates points from an *id-time points table*. If `keepref=FALSE` the reference of each point is set to `-1`. <br>
Example: <br><br>
# Returns the level of glucose one hour after the insulin shot was made <br>
emr_vtrack.create("glucose", "glucose_track", func = "avg", time.shift = 1) <br>
r &lt;- emr_extract("insulin_shot_track") # &lt;-- implicit iterator is used here <br>
emr_extract("glucose", iterator = r) <br></p></li>
<li><p>Ids Iterator: Ids iterator generates points with ids taken from an *ids table* and times that run from `stime` to `etime` with a step of 1. If `keepref=TRUE` for each id-time pair the iterator generates 255 points with references running from `0` to `254`. If `keepref=FALSE` only one point is generated for the given id and time, and its reference is set to `-1`.<br>
Example: <br><br>
stime &lt;- emr_date2time(1, 1, 2016, 0) <br>
etime &lt;- emr_date2time(31, 12, 2016, 23) <br>
emr_extract("glucose", iterator = data.frame(id = c(2, 5)), stime = stime, etime = etime)<br></p></li>
<li><p>Time Intervals Iterator: *Time intervals iterator* generates points for all the ids that appear in 'patients.dob' track with times taken from a *time intervals table* (see: Appendix). Each time starts at the beginning of the time interval and runs to the end of it with a step of 1. That being said the points that lie outside of `[stime, etime]` range are skipped. <br>
If `keepref=TRUE` for each id-time pair the iterator generates 255 points with references running from `0` to `254`. If `keepref=FALSE` only one point is generated for the given id and time, and its reference is set to `-1`. <br>
Example: <br>
# Returns the level of hangover for all patients the next day after New Year Eve for the years 2015 and 2016 <br>
stime1 &lt;- emr_date2time(1, 1, 2015, 0) <br>
etime1 &lt;- emr_date2time(1, 1, 2015, 23) <br>
stime2 &lt;- emr_date2time(1, 1, 2016, 0) <br>
etime2 &lt;- emr_date2time(1, 1, 2016, 23) <br>
emr_extract("alcohol_level_track", iterator = data.frame( <br>
    stime = c(stime1, stime2), <br>
    etime = c(etime1, etime2) <br>
)) <br></p></li>
<li><p>Id-Time Intervals Iterator: *Id-Time intervals iterator* generates for each id points that cover `['stime', 'etime']` time range as specified in *id-time intervals table* (see: Appendix). Each time starts at the beginning of the time interval and runs to the end of it with a step of 1. That being said the points that lie outside of `[stime, etime]` range are skipped. <br>
If `keepref=TRUE` for each id-time pair the iterator generates 255 points with references running from `0` to `254`. If `keepref=FALSE` only one point is generated for the given id and time, and its reference is set to `-1`</p></li>
<li><p>Beat Iterator: *Beat Iterator* generates a "time beat" at the given period for each id that appear in 'patients.dob' track. The period is given always in hours. <br>
Example: <br>
emr_extract("glucose_track", iterator=10, stime=1000, etime=2000) <br>
This will create a beat iterator with a period of 10 hours starting at `stime` up until `etime` is reached. If, for example, `stime` equals `1000` then the beat iterator will create for each id iterator points at times: 1000, 1010, 1020, ... <br>
If `keepref=TRUE` for each id-time pair the iterator generates 255 points with references running from `0` to `254`. If `keepref=FALSE` only one point is generated for the given id and time, and its reference is set to `-1`.</p></li>
<li><p>Extended Beat Iterator: *Extended beat iterator* is as its name suggests a variation on the beat iterator. It works by the same principle of creating time points with the given period however instead of basing the times count on `stime` it accepts an additional parameter - a track or a *Id-Time Points table* - that instructs what should be the initial time point for each of the ids. The two parameters (period and mapping) should come in a list. Each id is required to appear only once and if a certain id does not appear at all, it is skipped by the iterator. <br>
Anyhow points that lie outside of `[stime, etime]` range are not generated. <br>
Example: <br>
# Returns the maximal weight of patients at one year span starting from their birthdays <br>
emr_vtrack.create("weight", "weight_track", func = "max", time.shift = c(0, year())) <br>
emr_extract("weight", iterator = list(year(), "birthday_track"), stime = 1000, etime = 2000) <br></p></li>
<li><p>Periodic Iterator: periodic iterator goes over every year/month. You can use it by running  <code>emr_monthly_iterator</code> or <code>emr_yearly_iterator</code>. <br>
Example: <br>
iter &lt;- emr_yearly_iterator(emr_date2time(1, 1, 2002), emr_date2time(1, 1, 2017)) <br>
emr_extract("dense_track", iterator = iter, stime = 1, etime = 3) <br>
iter &lt;- emr_monthly_iterator(emr_date2time(1, 1, 2002), n = 15) <br>
emr_extract("dense_track", iterator = iter, stime = 1, etime = 3) <br></p></li>
<li><p>Implicit Iterator: The iterator is set implicitly if its value remains `NULL` (which is the default). In that case the track expression is analyzed and searched for track names. If all the track variables or virtual track variables point to the same track, this track is used as a source for a track iterator. If more then one track appears in the track expression, an error message is printed out notifying ambiguity.</p></li>
</ul><p>Revealing Current Iterator Time:
During the evaluation of a track expression one can access a specially defined variable named `EMR_TIME` (Python: `TIME`). This variable contains a vector (`numpy.ndarray` in Python) of current iterator times. The length of the vector matches the length of the track variable (which is a vector too). <br>
Note that some values in `EMR_TIME` might be set 0. Skip those intervals and the values of the track variables at the corresponding indices. <br>
# Returns times of the current iterator as a day of month <br>
emr_extract("emr_time2dayofmonth(EMR_TIME)", iterator = "sparse_track") <br></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="emr_screen.html">emr_screen</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="emr_db.init.html">emr_db.init_examples</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">emr_extract</span><span class="op">(</span><span class="st">"dense_track"</span>, stime <span class="op">=</span> <span class="fl">1</span>, etime <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   id time ref dense_track</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 22    1  -1          13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 24    1  -1          13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 25    1  -1          10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 25    2  -1          24</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 25    3  -1          34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 28    1  -1          13</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Misha Hoichman, Aviezer Lifshitz, Ben Gilat.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer></div>

  

  

  </body></html>

