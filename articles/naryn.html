<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>naryn • naryn</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="naryn">
<meta property="og:description" content="naryn">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">naryn</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.6.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/naryn.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/advanced.html">advanced naryn</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tanaylab/naryn/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="naryn_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>naryn</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tanaylab/naryn/blob/HEAD/vignettes/naryn.Rmd" class="external-link"><code>vignettes/naryn.Rmd</code></a></small>
      <div class="hidden name"><code>naryn.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">naryn</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'naryn'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     months</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="getting-started-with-naryn">Getting started with naryn<a class="anchor" aria-label="anchor" href="#getting-started-with-naryn"></a>
</h2>
<p>Naryn is an implmenetation of a time-series database, for efficient storage, retrieval and analysis of electronic health records (EHR). The basic element of Naryn is a track - single numerical data element (e.g. RBC lab test result) that is recorded for many patients at various time points. A track can be thought of as a very sparse two-dimentional matrix with a row for each patient in the database, and a column for each hour. The patient space is defined by a required track ‘patients.dob’ which must include all patients with a single timepoint at their time of birth. Time reflects the difference in hours to 1/3/1867 00:00.</p>
<div class="section level5">
<h5 id="connect-to-database">Connect to database<a class="anchor" aria-label="anchor" href="#connect-to-database"></a>
</h5>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emr_db.connect.html">emr_db.connect</a></span><span class="op">(</span><span class="st">"/home/nettam/emr/sample_db"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># show number of available tracks in database</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/emr_track.ls.html">emr_track.ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2995</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extract-all-patients-in-database">Extract all patients in database<a class="anchor" aria-label="anchor" href="#extract-all-patients-in-database"></a>
</h4>
<p>all patients must be listed in a track called ‘patients.dob’. This track contains for each patient a single time point at the time of birth. In this mock database, the value per patient reflect their sex: 1 for male, 2 for female.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">patients</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emr_extract.html">emr_extract</a></span><span class="op">(</span><span class="st">"patients.dob"</span>, names <span class="op">=</span> <span class="st">"sex"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">patients</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id    time ref sex</span></span>
<span><span class="co">#&gt; 1  1  535998  -1   1</span></span>
<span><span class="co">#&gt; 2  2 1024040  -1   2</span></span>
<span><span class="co">#&gt; 3  3  807917  -1   1</span></span>
<span><span class="co">#&gt; 4  4  864871  -1   1</span></span>
<span><span class="co">#&gt; 5  5  826123  -1   1</span></span>
<span><span class="co">#&gt; 6  6  817547  -1   2</span></span>
<span><span class="va">patients</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span><span class="op">[</span><span class="va">sex</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;      sex     n</span></span>
<span><span class="co">#&gt; 1   male 48621</span></span>
<span><span class="co">#&gt; 2 female 51379</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="define-virtual-track-for-age">Define virtual track for Age<a class="anchor" aria-label="anchor" href="#define-virtual-track-for-age"></a>
</h4>
<p>In order to know the age of a patient at different event times we will calculate the difference between the time of the event and the time the patient was born as found in the patients.dob track. This is done by defining a virtual track, whereby the souce of the virtual track is patients.dob. A time window from the time of the event backwords in time (up to max age = 120 years) should capture the time the patient was born. The difference in time is computed by the dt2.earliest function which computes the delta time (in hours) between the event time and the earliest appearance of a poin in the source track of the virtual track.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emr_vtrack.create.html">emr_vtrack.create</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"patients.dob"</span>, time.shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">120</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">24</span>, <span class="fl">0</span><span class="op">)</span>, func <span class="op">=</span> <span class="st">"dt2.earliest"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extract-age-and-wbc-test-value-at-time-of-test-for-each-test-performed-in-2010">extract age and wbc test value, at time of test for each test performed in 2010<a class="anchor" aria-label="anchor" href="#extract-age-and-wbc-test-value-at-time-of-test-for-each-test-performed-in-2010"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emr_extract.html">emr_extract</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age/(365*24)"</span>, <span class="st">"lab.WBC"</span><span class="op">)</span>, iterator <span class="op">=</span> <span class="st">"lab.WBC"</span>, stime <span class="op">=</span> <span class="fu"><a href="../reference/emr_date2time.html">emr_date2time</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2010</span><span class="op">)</span>, etime <span class="op">=</span> <span class="fu"><a href="../reference/emr_date2time.html">emr_date2time</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2011</span><span class="op">)</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"wbc"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id    time ref      age       wbc</span></span>
<span><span class="co">#&gt; 1  1 1252814  -1 81.82831  8.058747</span></span>
<span><span class="co">#&gt; 2  1 1253515  -1 81.90833  7.199924</span></span>
<span><span class="co">#&gt; 3  3 1257273  -1 51.29635  6.600398</span></span>
<span><span class="co">#&gt; 4  4 1253349  -1 44.34680  8.300706</span></span>
<span><span class="co">#&gt; 5  4 1254029  -1 44.42443  7.102493</span></span>
<span><span class="co">#&gt; 6  4 1256304  -1 44.68413 11.600000</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="define-virtual-track-for-survival---time-until-death">Define virtual track for Survival - time until death<a class="anchor" aria-label="anchor" href="#define-virtual-track-for-survival---time-until-death"></a>
</h4>
<p>assume that patients.dod is a track with a single entry at most for each patient in the EHR database at time of death.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emr_vtrack.create.html">emr_vtrack.create</a></span><span class="op">(</span><span class="st">"survival"</span>, <span class="st">"patients.dod"</span>, time.shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">120</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">24</span><span class="op">)</span>, func <span class="op">=</span> <span class="st">"dt1.earliest"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extract-survival-time-for-patients-with-pancreatic-cancer">Extract survival time for patients with pancreatic cancer<a class="anchor" aria-label="anchor" href="#extract-survival-time-for-patients-with-pancreatic-cancer"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pancreatic cancer icd9 code is 157.9</span></span>
<span><span class="co"># note that since icd9 diagnosis codes have a tree like structure, and X.0, X.00 are both valid codes and must be distinguishable,</span></span>
<span><span class="co"># the diagnosis tracks all include a prefix of 1 for the minor code, so X.0 will be translated to icd9_X and a value of 10 will be stored.</span></span>
<span></span>
<span><span class="co"># define a filter for just Pancreatic cancer in the 157 icd9 code.</span></span>
<span><span class="fu"><a href="../reference/emr_filter.create.html">emr_filter.create</a></span><span class="op">(</span><span class="st">"pancreatic_cancer"</span>, <span class="st">"dx.icd9_157"</span>, val <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span>
<span><span class="co"># define a filter for previous pancreatic cancer (sometime in the past).</span></span>
<span><span class="fu"><a href="../reference/emr_filter.create.html">emr_filter.create</a></span><span class="op">(</span><span class="st">"pancreatic_cancer_in_past"</span>, <span class="st">"dx.icd9_157"</span>, val <span class="op">=</span> <span class="fl">19</span>, time.shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">120</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">24</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># to find the first diagnosis of pancreatic cancer we will go over all 157 diagnosis, filter out those that are not pancreatic cancer and make sure there wasn't a prior diagnosis of pancreatic cancer</span></span>
<span><span class="va">pancreatic_cancer_survival</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emr_extract.html">emr_extract</a></span><span class="op">(</span><span class="st">"survival"</span>, iterator <span class="op">=</span> <span class="st">"dx.icd9_157"</span>, filter <span class="op">=</span> <span class="st">"pancreatic_cancer &amp; !pancreatic_cancer_in_past"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pancreatic_cancer_survival</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 25</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pancreatic_cancer_survival</span><span class="op">)</span></span>
<span><span class="co">#&gt;      id    time ref survival</span></span>
<span><span class="co">#&gt; 1 12192 1256866  -1    19910</span></span>
<span><span class="co">#&gt; 2 17022 1311645  -1      NaN</span></span>
<span><span class="co">#&gt; 3 24217 1309964  -1    14332</span></span>
<span><span class="co">#&gt; 4 27971 1280769  -1     3927</span></span>
<span><span class="co">#&gt; 5 28135 1263030  -1    23106</span></span>
<span><span class="co">#&gt; 6 34252 1341200  -1     9016</span></span>
<span></span>
<span><span class="co"># note that NA in survival means that the patient still has not died</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># kaplan meier for survival of pancreatic cancer patients</span></span>
<span><span class="co"># censoring is applied to reflect latest update of database (Jan 6, 2022)</span></span>
<span><span class="va">pancreatic_cancer_survival</span> <span class="op">&lt;-</span> <span class="va">pancreatic_cancer_survival</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        follow_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">survival</span><span class="op">)</span>, <span class="va">survival</span>, <span class="fu"><a href="../reference/emr_date2time.html">emr_date2time</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">2022</span><span class="op">)</span> <span class="op">-</span> <span class="va">time</span><span class="op">)</span>,</span>
<span>        status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">survival</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fitting survival curve</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">survminer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survminer/man/surv_fit.html" class="external-link">surv_fit</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">follow_time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">pancreatic_cancer_survival</span><span class="op">)</span></span>
<span><span class="fu">survminer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html" class="external-link">ggsurvplot</a></span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">pancreatic_cancer_survival</span><span class="op">)</span></span></code></pre></div>
<p><img src="naryn_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="extract-hgb-and-age-for-all-patients-between-the-ages-60-and-70">Extract HGB and age for all patients between the ages 60 and 70<a class="anchor" aria-label="anchor" href="#extract-hgb-and-age-for-all-patients-between-the-ages-60-and-70"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create an age filter. If we go over a BMI test value for a patient, then we expect there to be a date of birth entry between 70 and 60 years before. This would mean that the patient is in the required age range</span></span>
<span><span class="fu"><a href="../reference/emr_filter.create.html">emr_filter.create</a></span><span class="op">(</span><span class="st">"age_60_70"</span>, <span class="st">"patients.dob"</span>, time.shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">70</span>, <span class="op">-</span><span class="fl">60</span><span class="op">)</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">24</span><span class="op">)</span></span>
<span><span class="va">hgb_60_70</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emr_extract.html">emr_extract</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age/(24*365)"</span>, <span class="st">"lab.HGB"</span><span class="op">)</span>, iterator <span class="op">=</span> <span class="st">"lab.HGB"</span>, filter <span class="op">=</span> <span class="st">"age_60_70"</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"hgb"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">hgb_60_70</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span></span></code></pre></div>
<p><img src="naryn_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">hgb_60_70</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hgb</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 17 rows containing non-finite values (stat_density).</span></span></code></pre></div>
<p><img src="naryn_files/figure-html/unnamed-chunk-12-2.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># adding sex information as hgb has bimodal distribution</span></span>
<span><span class="co"># sex is encoded in the patients.dob track, 1 for male and 2 for female</span></span>
<span><span class="fu"><a href="../reference/emr_vtrack.create.html">emr_vtrack.create</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"patients.dob"</span>, time.shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">120</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">24</span>, <span class="fl">0</span><span class="op">)</span>, func <span class="op">=</span> <span class="st">"earliest"</span><span class="op">)</span></span>
<span><span class="va">hgb_sex_60_70</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emr_extract.html">emr_extract</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age/(24*365)"</span>, <span class="st">"sex"</span>, <span class="st">"lab.HGB"</span><span class="op">)</span>, iterator <span class="op">=</span> <span class="st">"lab.HGB"</span>, filter <span class="op">=</span> <span class="st">"age_60_70"</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"hgb"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span><span class="op">[</span><span class="va">sex</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">hgb_sex_60_70</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">sex</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span></span></code></pre></div>
<p><img src="naryn_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">hgb_sex_60_70</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hgb</span>, color <span class="op">=</span> <span class="va">sex</span>, group <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 17 rows containing non-finite values (stat_density).</span></span></code></pre></div>
<p><img src="naryn_files/figure-html/unnamed-chunk-14-2.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="extract-patients-age-at-time-of-diagnosis-of-heart-disease-diagnosis-411-that-did-not-have-diabetes-diagnosis-250">Extract patients age at time of diagnosis of heart disease (diagnosis.411) that did not have diabetes (diagnosis.250)<a class="anchor" aria-label="anchor" href="#extract-patients-age-at-time-of-diagnosis-of-heart-disease-diagnosis-411-that-did-not-have-diabetes-diagnosis-250"></a>
</h4>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># find onset of heart disease</span></span>
<span><span class="fu"><a href="../reference/emr_vtrack.create.html">emr_vtrack.create</a></span><span class="op">(</span><span class="st">"heart_onset"</span>, <span class="st">"dx.icd9_411"</span>, time.shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">120</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">24</span><span class="op">)</span>, func <span class="op">=</span> <span class="st">"earliest.time"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/emr_filter.create.html">emr_filter.create</a></span><span class="op">(</span><span class="st">"has_heart_disease"</span>, <span class="st">"dx.icd9_411"</span>, time.shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">120</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">24</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># retrieving the earliest time of heart disease for all patients in db that have a heart disease</span></span>
<span><span class="va">heart_onset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emr_extract.html">emr_extract</a></span><span class="op">(</span><span class="st">"heart_onset"</span>, iterator <span class="op">=</span> <span class="st">"patients.dob"</span>, filter <span class="op">=</span> <span class="st">"has_heart_disease"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter patients that already have diabetes before heart disease</span></span>
<span><span class="fu"><a href="../reference/emr_filter.create.html">emr_filter.create</a></span><span class="op">(</span><span class="st">"has_diabetes"</span>, <span class="st">"dx.icd9_250"</span>, time.shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">120</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">24</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">heart_onset_no_diabetes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emr_extract.html">emr_extract</a></span><span class="op">(</span><span class="st">"age/(365*24)"</span>, iterator <span class="op">=</span> <span class="va">heart_onset</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, time <span class="op">=</span> <span class="va">heart_onset</span><span class="op">)</span>, filter <span class="op">=</span> <span class="st">"!has_diabetes"</span>, names <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">heart_onset</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 25596</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">heart_onset_no_diabetes</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5137</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">heart_onset_no_diabetes</span><span class="op">)</span></span>
<span><span class="co">#&gt;    id    time ref      age</span></span>
<span><span class="co">#&gt; 1   6 1259009  -1 50.39521</span></span>
<span><span class="co">#&gt; 2  31 1229936  -1 69.97317</span></span>
<span><span class="co">#&gt; 3  36 1236550  -1 42.01963</span></span>
<span><span class="co">#&gt; 4  66 1237208  -1 71.25753</span></span>
<span><span class="co">#&gt; 5 114 1320426  -1 68.11872</span></span>
<span><span class="co">#&gt; 6 132 1352258  -1 68.12420</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extract-median-hemoglobin-for-all-males-between-ages-60-to-70">Extract median Hemoglobin for all males between ages 60 to 70<a class="anchor" aria-label="anchor" href="#extract-median-hemoglobin-for-all-males-between-ages-60-to-70"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define vtrack for computing the median value of hgb track, assuming patients.dob will be used as the iterator (each patient will be examined once)</span></span>
<span><span class="fu"><a href="../reference/emr_vtrack.create.html">emr_vtrack.create</a></span><span class="op">(</span><span class="st">"median_hgb"</span>, <span class="st">"lab.HGB"</span>, time.shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">70</span><span class="op">)</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">24</span>, func <span class="op">=</span> <span class="st">"quantile"</span>, params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a filter for males only</span></span>
<span><span class="fu"><a href="../reference/emr_filter.create.html">emr_filter.create</a></span><span class="op">(</span><span class="st">"is_male"</span>, <span class="st">"patients.dob"</span>, time.shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, val <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract median_hgb for males only</span></span>
<span><span class="va">male_hgb_60_70_q50</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emr_extract.html">emr_extract</a></span><span class="op">(</span><span class="st">"median_hgb"</span>, iterator <span class="op">=</span> <span class="st">"patients.dob"</span>, filter <span class="op">=</span> <span class="st">"is_male"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># comparing with female median hgb</span></span>
<span><span class="va">female_hgb_60_70_q50</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emr_extract.html">emr_extract</a></span><span class="op">(</span><span class="st">"median_hgb"</span>, iterator <span class="op">=</span> <span class="st">"patients.dob"</span>, filter <span class="op">=</span> <span class="st">"!is_male"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">male_hgb_60_70_q50</span><span class="op">$</span><span class="va">median_hgb</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, main <span class="op">=</span> <span class="st">"median hgb"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">female_hgb_60_70_q50</span><span class="op">$</span><span class="va">median_hgb</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="naryn_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="compute-distribution-of-hgb-by-age-and-sex">Compute distribution of HGB by age and sex<a class="anchor" aria-label="anchor" href="#compute-distribution-of-hgb-by-age-and-sex"></a>
</h4>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hgb_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emr_dist.html">emr_dist</a></span><span class="op">(</span><span class="st">"age/(24*365)"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">50</span>, <span class="fl">90</span><span class="op">)</span>,</span>
<span>    <span class="st">"sex"</span>, <span class="cn">NULL</span>,</span>
<span>    <span class="st">"lab.HGB"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">16</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    iterator <span class="op">=</span> <span class="st">"lab.HGB"</span>,</span>
<span>    dataframe <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"hgb"</span><span class="op">)</span>,</span>
<span>    right <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hgb_dist</span><span class="op">)</span></span>
<span><span class="co">#&gt;       age sex       hgb    n</span></span>
<span><span class="co">#&gt; 1 [20,50)   1 [10,10.5)  266</span></span>
<span><span class="co">#&gt; 2 [50,90)   1 [10,10.5) 2948</span></span>
<span><span class="co">#&gt; 3 [20,50)   2 [10,10.5) 6930</span></span>
<span><span class="co">#&gt; 4 [50,90)   2 [10,10.5) 8402</span></span>
<span><span class="co">#&gt; 5 [20,50)   1 [10.5,11)  344</span></span>
<span><span class="co">#&gt; 6 [50,90)   1 [10.5,11) 4355</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">hgb_dist</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span><span class="op">[</span><span class="va">sex</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hgb</span>, y <span class="op">=</span> <span class="va">n</span>, colour <span class="op">=</span> <span class="va">age</span>, group <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="naryn_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### Count number of patients by age that are in the system in january 2020</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># patients in the system must have already been born, have not yet died, registered with the EHR system and that haven't left for good</span></span>
<span><span class="fu"><a href="../reference/emr_filter.create.html">emr_filter.create</a></span><span class="op">(</span><span class="st">"born"</span>, <span class="st">"patients.dob"</span>, time.shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">120</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">24</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/emr_filter.create.html">emr_filter.create</a></span><span class="op">(</span><span class="st">"dead"</span>, <span class="st">"patients.dod"</span>, time.shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">120</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">24</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/emr_filter.create.html">emr_filter.create</a></span><span class="op">(</span><span class="st">"registered"</span>, <span class="st">"patients.status.register"</span>, time.shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">120</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">24</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/emr_filter.create.html">emr_filter.create</a></span><span class="op">(</span><span class="st">"left_for_good"</span>, <span class="st">"patients.status.lfg"</span>, time.shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">120</span> <span class="op">*</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">24</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">age_dist_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emr_dist.html">emr_dist</a></span><span class="op">(</span><span class="st">"age/(365*24)"</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">120</span>, <span class="st">"sex"</span>, <span class="cn">NULL</span>,</span>
<span>    iterator <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    stime <span class="op">=</span> <span class="fu"><a href="../reference/emr_date2time.html">emr_date2time</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2020</span><span class="op">)</span>,</span>
<span>    etime <span class="op">=</span> <span class="fu"><a href="../reference/emr_date2time.html">emr_date2time</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2020</span><span class="op">)</span>,</span>
<span>    filter <span class="op">=</span> <span class="st">"born &amp; !dead &amp; registered &amp; !left_for_good"</span>,</span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span><span class="op">)</span>,</span>
<span>    dataframe <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    right <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">age_dist_2020</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       age sex   n</span></span>
<span><span class="co">#&gt; 1 [19,20)   1  38</span></span>
<span><span class="co">#&gt; 2 [20,21)   1 105</span></span>
<span><span class="co">#&gt; 3 [21,22)   1 176</span></span>
<span><span class="co">#&gt; 4 [22,23)   1 250</span></span>
<span><span class="co">#&gt; 5 [23,24)   1 370</span></span>
<span><span class="co">#&gt; 6 [24,25)   1 436</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>repr.plot.width <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">age_dist_2020</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span><span class="op">[</span><span class="va">sex</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">n</span>, colour <span class="op">=</span> <span class="va">sex</span>, fill <span class="op">=</span> <span class="va">sex</span>, group <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">sex</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="naryn_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Misha Hoichman, Aviezer Lifshitz, Ben Gilat.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
